<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime World</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#111;
  color:#fff;
}
header{
  background:#222;
  padding:15px;
  text-align:center;
}
#searchBar{
  width:60%;
  padding:10px;
  border:none;
  border-radius:5px;
  margin-top:10px;
}
#buttons{
  margin-top:10px;
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
}
button{
  padding:10px 15px;
  border:none;
  border-radius:5px;
  background:#ff6600;
  color:#fff;
  cursor:pointer;
}
button:hover{
  background:#ff8533;
}
#animeGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:15px;
  padding:20px;
}
.animeCard{
  background:#333;
  border-radius:8px;
  overflow:hidden;
  cursor:pointer;
  transition:0.3s;
  position:relative;
}
.animeCard:hover{
  transform:scale(1.05);
}
.animeCard img{
  width:100%;
  height:300px;
  object-fit:cover;
}
.animeTitle{
  padding:10px;
  text-align:center;
  font-weight:bold;
}
.fav{
  position:absolute;
  top:10px;
  right:10px;
  font-size:22px;
  cursor:pointer;
}
.fav.active{
  color:red;
}
#details{
  display:none;
  position:fixed;
  inset:0;
  background:#000;
  overflow-y:auto;
  padding:20px;
}
#details img{
  width:300px;
  border-radius:8px;
}
#episodeList{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:15px;
}
iframe{
  width:100%;
  max-width:900px;
  height:500px;
  border:none;
  margin-top:15px;
  border-radius:8px;
}
</style>
</head>

<body>

<header>
  <h1>ğŸŒ Anime World</h1>
  <input id="searchBar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…ÙŠ..." />
  <div id="buttons">
    <button onclick="topAnime()">Ø£ÙØ¶Ù„ Ø£Ù†Ù…ÙŠ</button>
    <button onclick="allAnime()">ÙƒÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª</button>
    <button onclick="showFav()">Ø§Ù„Ù…ÙØ¶Ù„Ø© â¤ï¸</button>
  </div>
</header>

<div id="animeGrid"></div>

<div id="details">
  <button onclick="closeDetails()">â¬… Ø±Ø¬ÙˆØ¹</button>
  <h2 id="dTitle"></h2>
  <img id="dImg">
  <p id="dInfo"></p>
  <p id="dDesc"></p>
  <div id="episodeList"></div>
  <iframe id="player" allowfullscreen></iframe>
</div>

<script>
const grid = document.getElementById("animeGrid");
const searchBar = document.getElementById("searchBar");
const details = document.getElementById("details");
const dTitle = document.getElementById("dTitle");
const dImg = document.getElementById("dImg");
const dDesc = document.getElementById("dDesc");
const dInfo = document.getElementById("dInfo");
const episodeList = document.getElementById("episodeList");
const player = document.getElementById("player");

let favorites = [];

// AniList GraphQL
async function aniList(query){
  const r = await fetch("https://graphql.anilist.co",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ query })
  });
  return r.json();
}

// ØªØ±Ø¬Ù…Ø© Ø¹Ø±Ø¨ÙŠ
async function translate(text){
  if(!text) return "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ";
  try{
    const r = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|ar`);
    const j = await r.json();
    return j.responseData.translatedText;
  }catch{
    return text;
  }
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø£Ù†Ù…ÙŠ
function card(anime){
  const div = document.createElement("div");
  div.className="animeCard";
  div.innerHTML=`
    <img src="${anime.coverImage.large}">
    <div class="animeTitle">${anime.title.romaji}</div>
    <span class="fav ${favorites.includes(anime.id)?"active":""}">â¤</span>
  `;
  div.querySelector(".fav").onclick=(e)=>{
    e.stopPropagation();
    toggleFav(anime.id,e.target);
  };
  div.onclick=()=>openDetails(anime);
  grid.appendChild(div);
}

// ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠ
async function openDetails(anime){
  details.style.display="block";
  dTitle.textContent = anime.title.romaji;
  dImg.src = anime.coverImage.large;
  dDesc.textContent = await translate(anime.description);
  dInfo.innerHTML = `
    Ø§Ù„Ø­Ø§Ù„Ø©: ${anime.status} |
    Ø§Ù„Ø­Ù„Ù‚Ø§Øª: ${anime.episodes || "ØŸ"} |
    Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${anime.averageScore || "N/A"} |
    Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ: ${anime.studios.nodes.map(s=>s.name).join(", ")}
  `;
  episodeList.innerHTML="";
  player.src="";
  if(anime.episodes){
    for(let i=1;i<=anime.episodes;i++){
      const b=document.createElement("button");
      b.textContent=`Ø­Ù„Ù‚Ø© ${i}`;
      // Ø±Ø¨Ø· Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø¹Ø¨Ø± VidNest
      b.onclick=()=>player.src=`https://vidnest.com/embed/anime/${anime.id}/${i}`;
      episodeList.appendChild(b);
    }
  }
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„
function closeDetails(){
  details.style.display="none";
  player.src="";
}

// Ø§Ù„Ù…ÙØ¶Ù„Ø©
function toggleFav(id,el){
  if(favorites.includes(id)){
    favorites=favorites.filter(x=>x!==id);
    el.classList.remove("active");
  }else{
    favorites.push(id);
    el.classList.add("active");
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¶Ù„Ø©
function showFav(){
  grid.innerHTML="";
  if(favorites.length===0){
    grid.innerHTML="<p style='padding:20px'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙØ¶Ù„Ø©</p>";
    return;
  }
  favorites.forEach(id=>{
    aniList(`query{Media(id:${id},type:ANIME){id title{romaji} description coverImage{large} episodes status averageScore studios{nodes{name}}}}`)
    .then(d=>card(d.data.Media));
  });
}

// Ø£ÙØ¶Ù„ 30 Ø£Ù†Ù…ÙŠ
async function topAnime(){
  grid.innerHTML="";
  const q=`query{Page(perPage:30){media(type:ANIME,sort:SCORE_DESC){id title{romaji} description coverImage{large} episodes status averageScore studios{nodes{name}}}}}`;
  const d=await aniList(q);
  d.data.Page.media.forEach(card);
}

// ÙƒÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª (100 Ù„ÙƒÙ„ Ù…Ø±Ø©)
async function allAnime(){
  grid.innerHTML="";
  const q=`query{Page(perPage:100){media(type:ANIME,sort:POPULARITY_DESC){id title{romaji} description coverImage{large} episodes status averageScore studios{nodes{name}}}}}`;
  const d=await aniList(q);
  d.data.Page.media.forEach(card);
}

// Ø§Ù„Ø¨Ø­Ø«
searchBar.addEventListener("keydown",async e=>{
  if(e.key==="Enter"){
    grid.innerHTML="";
    const q=`query{Page(perPage:30){media(search:"${searchBar.value}",type:ANIME){id title{romaji} description coverImage{large} episodes status averageScore studios{nodes{name}}}}}`;
    const d=await aniList(q);
    if(d.data.Page.media.length===0){
      grid.innerHTML="<p style='padding:20px'>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø£Ù†Ù…ÙŠ</p>";
    } else {
      d.data.Page.media.forEach(card);
    }
  }
});

// ØªØ­Ù…ÙŠÙ„ Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
topAnime();
</script>

</body>
</html>
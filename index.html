<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime Jikan</title>
<style>
  body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:0; }
  header { padding:20px; text-align:center; background:#222; }
  #searchBar { width:60%; padding:10px; border-radius:5px; border:none; }
  #animeGrid { display:grid; grid-template-columns:repeat(auto-fill, minmax(150px,1fr)); gap:15px; padding:20px; }
  .animeCard { background:#333; border-radius:8px; cursor:pointer; overflow:hidden; transition:0.3s; }
  .animeCard:hover { transform:scale(1.05); }
  .animeCard img { width:100%; height:200px; object-fit:cover; }
  .animeTitle { padding:10px; text-align:center; font-weight:bold; }
  #animeDetails { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); padding:40px; overflow-y:auto; }
  #closeBtn { float:right; cursor:pointer; font-size:25px; }
  #episodeList { display:flex; flex-wrap:wrap; gap:10px; margin-top:15px; }
  #episodeList button { margin:5px; padding:5px 10px; background:#ff6600; color:#fff; border:none; border-radius:5px; cursor:pointer; }
  video { width:100%; max-width:600px; margin-top:15px; border-radius:5px; }
  #backBtn { display:none; margin:10px auto; padding:10px 20px; background:#ff6600; color:#fff; border:none; border-radius:5px; cursor:pointer; display:block; }
</style>
</head>
<body>
<header>
  <h1>Anime Jikan</h1>
  <input type="text" id="searchBar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù†Ù…ÙŠ...">
  <button id="backBtn">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
</header>

<div id="animeGrid"></div>

<div id="animeDetails">
  <span id="closeBtn">&times;</span>
  <h2 id="detailTitle"></h2>
  <img id="detailCover" src="" alt="" style="width:300px;height:auto;">
  <p id="detailDescription"></p>
  <div id="episodeList"></div>
  <video id="episodePlayer" controls></video>
</div>

<script>
const grid = document.getElementById("animeGrid");
const searchBar = document.getElementById("searchBar");
const details = document.getElementById("animeDetails");
const closeBtn = document.getElementById("closeBtn");
const detailTitle = document.getElementById("detailTitle");
const detailCover = document.getElementById("detailCover");
const detailDesc = document.getElementById("detailDescription");
const episodeList = document.getElementById("episodeList");
const episodePlayer = document.getElementById("episodePlayer");
const backBtn = document.getElementById("backBtn");

// ğŸŒŸ Ø¬Ù„Ø¨ Top Anime
async function fetchTopAnime() {
  try {
    const resp = await fetch("https://api.jikan.moe/v4/top/anime");
    const data = await resp.json();
    displayAnime(data.data.slice(0,30));
    backBtn.style.display = "none";
  } catch(err) {
    console.error("Ø®Ø·Ø£ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù†Ù…ÙŠ:", err);
    grid.innerHTML="<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø£Ù†Ù…ÙŠ.</p>";
  }
}

// ğŸŒŸ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
async function searchAnime(query){
  try{
    const resp = await fetch(`https://api.jikan.moe/v4/anime?q=${encodeURIComponent(query)}&limit=50`);
    const data = await resp.json();
    let results = data.data || [];

    results = results.filter(a => 
      a.title.toLowerCase().includes(query.toLowerCase()) ||
      (a.title_english && a.title_english.toLowerCase().includes(query.toLowerCase())) ||
      (a.title_japanese && a.title_japanese.includes(query))
    );

    if(results.length === 0){
      grid.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ù†Ù…ÙŠ Ù…Ø·Ø§Ø¨Ù‚.</p>";
      backBtn.style.display = "inline-block";
      return;
    }

    displayAnime(results);
    backBtn.style.display = "inline-block";

  } catch(err){
    console.error("Ø®Ø·Ø£ Ø§Ù„Ø¨Ø­Ø«:", err);
    grid.innerHTML = "<p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«.</p>";
  }
}

// ğŸŒŸ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù†Ù…ÙŠ
function displayAnime(animes){
  grid.innerHTML="";
  if(animes.length===0){ grid.innerHTML="<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø£Ù†Ù…ÙŠ.</p>"; return; }
  animes.forEach(async anime=>{
    const card=document.createElement("div");
    card.className="animeCard";
    card.innerHTML=`<img src="${anime.images.jpg.image_url}" alt="${anime.title}"><div class="animeTitle">${anime.title}</div>`;
    card.onclick=()=>showDetails(anime);
    grid.appendChild(card);
  });
}

// ğŸŒŸ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù†Øµ Ù„Ù„Ø¹Ø±Ø¨ÙŠ
async function translateText(text){
  if(!text) return "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ";
  if(text.length > 450) text = text.slice(0,450) + "...";
  try{
    const resp = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|ar`);
    const data = await resp.json();
    return data.responseData.translatedText || text;
  }catch(e){
    console.error("Ø®Ø·Ø£ Ø§Ù„ØªØ±Ø¬Ù…Ø©:", e);
    return text;
  }
}

// ğŸŒŸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠ
async function showDetails(anime){
  details.style.display="block";
  detailTitle.textContent=anime.title;
  detailCover.src=anime.images.jpg.image_url;
  detailDesc.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  // ØªØ±Ø¬Ù…Ø© Ø§Ù„ÙˆØµÙ
  const translated = await translateText(anime.synopsis);
  detailDesc.textContent = translated;

  episodeList.innerHTML="";
  // Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ù„Ù‚Ø§Øª ØªÙ‚Ø¯Ø± ØªØ¶ÙŠÙÙ‡Ø§ Ù‡Ù†Ø§
}

// ğŸŒŸ Ø¥ØºÙ„Ø§Ù‚ ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
closeBtn.onclick = () => {
  details.style.display="none";
  episodePlayer.pause();
  episodePlayer.src="";
}

// ğŸŒŸ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø©
backBtn.onclick = () => {
  fetchTopAnime();
  searchBar.value = "";
  backBtn.style.display = "none";
}

// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Enter
searchBar.addEventListener("keyup",(e)=>{
  if(e.key==="Enter") searchAnime(searchBar.value);
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª Ø§Ù„Ø´Ø¹Ø¨ÙŠØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
fetchTopAnime();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime AniList</title>
<style>
body { font-family: Arial,sans-serif; background:#111; color:#fff; margin:0; padding:0; display:flex; }
#sidebar { width:220px; background:#222; padding:20px; box-sizing:border-box; height:100vh; overflow-y:auto; }
#sidebar h2 { margin-top:0; }
#sidebar button { width:100%; margin:5px 0; padding:10px; border:none; border-radius:5px; background:#ff6600; color:#fff; cursor:pointer; transition:0.3s; text-align:left; }
#sidebar button:hover { background:#ff9933; }
#main { flex:1; padding:20px; overflow-y:auto; }
#searchBar { width:100%; padding:10px; border-radius:5px; border:none; margin-bottom:10px; }
#animeGrid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:15px; }
.animeCard { background:#333; border-radius:8px; cursor:pointer; overflow:hidden; transition:0.3s; position:relative; }
.animeCard:hover { transform:scale(1.05); }
.animeCard img { width:100%; height:200px; object-fit:cover; }
.animeTitle { padding:10px; text-align:center; font-weight:bold; }
.favorite { position:absolute; top:5px; right:5px; font-size:20px; cursor:pointer; }
.favorite.red { color:red; }
#animeDetails { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); padding:40px; overflow-y:auto; }
#closeBtn { cursor:pointer; font-size:20px; background:#ff6600; border:none; padding:5px 10px; border-radius:5px; color:#fff; margin-bottom:10px; }
#episodeList { display:flex; flex-wrap:wrap; gap:10px; margin-top:15px; }
video { width:100%; max-width:600px; margin-top:15px; border-radius:5px; }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
  <button onclick="showFavorites()">Ø§Ù„Ù…ÙØ¶Ù„Ø© â¤ï¸</button>
  <button onclick="showAllGenres()">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</button>
  <button onclick="showAllSeasons()">Ø§Ù„Ù…ÙˆØ§Ø³Ù…</button>
  <button onclick="showTopAnime()">Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª</button>
  <button onclick="showAllAnime()">ÙƒÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª</button>
</div>

<div id="main">
  <input type="text" id="searchBar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…ÙŠ...">
  <div id="animeGrid"></div>
</div>

<div id="animeDetails">
  <button id="closeBtn">Ø±Ø¬ÙˆØ¹</button>
  <h2 id="detailTitle"></h2>
  <img id="detailCover" src="" alt="" style="width:300px;height:auto;">
  <p id="detailInfo"></p>
  <p id="detailDescription"></p>
  <div id="episodeList"></div>
  <video id="episodePlayer" controls></video>
</div>

<script>
const grid = document.getElementById("animeGrid");
const searchBar = document.getElementById("searchBar");
const details = document.getElementById("animeDetails");
const closeBtn = document.getElementById("closeBtn");
const detailTitle = document.getElementById("detailTitle");
const detailCover = document.getElementById("detailCover");
const detailDesc = document.getElementById("detailDescription");
const detailInfo = document.getElementById("detailInfo");
const episodeList = document.getElementById("episodeList");

let favorites = [];

// ğŸŒŸ AniList GraphQL Fetch
async function fetchAniList(query) {
  const resp = await fetch('https://graphql.anilist.co', {
    method: 'POST',
    headers: { 'Content-Type':'application/json','Accept':'application/json' },
    body: JSON.stringify({ query })
  });
  return await resp.json();
}

// ğŸŒŸ Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª
async function showTopAnime(){
  const query = `
    query {
      Page(perPage:50){
        media(type:ANIME, sort:POPULARITY_DESC){
          id title { romaji } description(asHtml:false) coverImage { large } genres episodes status averageScore startDate { year,month,day } studios { nodes { name } } season
        }
      }
    }
  `;
  const data = await fetchAniList(query);
  displayAnime(data.data.Page.media);
}

// ğŸŒŸ Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª
async function showAllAnime(){
  const query = `
    query {
      Page(perPage:100){
        media(type:ANIME, sort=POPULARITY_DESC){
          id title { romaji } description(asHtml:false) coverImage { large } genres episodes status averageScore startDate { year,month,day } studios { nodes { name } } season
        }
      }
    }
  `;
  const data = await fetchAniList(query);
  displayAnime(data.data.Page.media);
}

// ğŸŒŸ Ø¹Ø±Ø¶ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
function showAllGenres(){
  const genres = ["Action","Comedy","Drama","Fantasy","Horror","Romance","School"];
  grid.innerHTML="";
  genres.forEach(g=>{
    const btn=document.createElement("button");
    btn.textContent=g;
    btn.onclick=()=>searchByGenre(g);
    grid.appendChild(btn);
  });
}

// ğŸŒŸ Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ
async function searchByGenre(genre){
  const query = `
    query {
      Page(perPage:50){
        media(type:ANIME, genre:"${genre}"){
          id title { romaji } description(asHtml:false) coverImage { large } genres episodes status averageScore startDate { year,month,day } studios { nodes { name } } season
        }
      }
    }
  `;
  const data = await fetchAniList(query);
  displayAnime(data.data.Page.media);
}

// ğŸŒŸ Ø§Ù„Ù…ÙˆØ§Ø³Ù…
function showAllSeasons(){
  const seasons = ["WINTER","SPRING","SUMMER","FALL"];
  grid.innerHTML="";
  seasons.forEach(s=>{
    const btn=document.createElement("button");
    btn.textContent=s;
    btn.onclick=()=>searchBySeason(s);
    grid.appendChild(btn);
  });
}

// ğŸŒŸ Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ³Ù…
async function searchBySeason(season){
  const query = `
    query {
      Page(perPage:50){
        media(type:ANIME, season:${season}){
          id title { romaji } description(asHtml:false) coverImage { large } genres episodes status averageScore startDate { year,month,day } studios { nodes { name } } season
        }
      }
    }
  `;
  const data = await fetchAniList(query);
  displayAnime(data.data.Page.media);
}

// ğŸŒŸ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¶Ù„Ø©
function showFavorites(){
  if(favorites.length===0){ grid.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ù…ÙŠØ§Øª Ù…ÙØ¶Ù„Ø©.</p>"; return; }
  displayAnime(favorites);
}

// ğŸŒŸ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù†Ù…ÙŠ
function displayAnime(animes){
  grid.innerHTML="";
  if(!animes || animes.length===0){ grid.innerHTML="<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø£Ù†Ù…ÙŠ.</p>"; return; }
  animes.forEach(anime=>{
    const card=document.createElement("div");
    card.className="animeCard";
    const isFav = favorites.find(f=>f.id===anime.id);
    card.innerHTML=`<img src="${anime.coverImage.large}" alt="${anime.title.romaji}">
                      <div class="animeTitle">${anime.title.romaji}</div>
                      <div class="favorite ${isFav?'red':''}" onclick="toggleFavorite(event,${anime.id})">&#10084;</div>`;
    card.onclick=()=>showDetails(anime);
    grid.appendChild(card);
  });
}

// ğŸŒŸ Ø¥Ø¶Ø§ÙØ©/Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©
function toggleFavorite(e,id){
  e.stopPropagation();
  const anime = Array.from(grid.children).find(c=>c.onclick && c.onclick.toString().includes(id));
  if(!anime) return;
  const card = e.target;
  const favAnime = favorites.find(f=>f.id===id);
  if(favAnime){
    favorites = favorites.filter(f=>f.id!==id);
    card.classList.remove("red");
  } else {
    const aniObj = anime.onclickAnimeObj || {};
    favorites.push(aniObj);
    card.classList.add("red");
  }
}

// ğŸŒŸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠ
function showDetails(anime){
  details.style.display="block";
  detailTitle.textContent=anime.title.romaji;
  detailCover.src=anime.coverImage.large;
  detailDesc.textContent=anime.description ? anime.description : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ";
  detailInfo.textContent=`Ø§Ù„Ø­Ù„Ù‚Ø§Øª: ${anime.episodes || "-"} | Ø§Ù„Ø­Ø§Ù„Ø©: ${anime.status || "-"} | Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${anime.averageScore || "-"} | Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ: ${anime.studios.nodes.map(s=>s.name).join(", ") || "-"}`;
  episodeList.innerHTML="";
}

// ğŸŒŸ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
closeBtn.onclick = () => { details.style.display="none"; };

// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Enter
searchBar.addEventListener("keyup",(e)=>{
  if(e.key==="Enter") searchAnime(searchBar.value);
});

// ØªØ­Ù…ÙŠÙ„ Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
showTopAnime();
</script>
</body>
</html>
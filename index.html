<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>دردشة DistilGPT2</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
h2 { color: #333; }
#chatBox { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; background: #fff; margin-bottom: 10px;}
input, button { padding: 10px; font-size: 16px; }
button { cursor: pointer; }
</style>
</head>
<body>
<h2>دردشة AI (DistilGPT2)</h2>

<div id="chatBox"></div>
<input type="text" id="userInput" placeholder="اكتب سؤالك هنا" style="width:70%;">
<button onclick="askAI()">إرسال</button>

<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers/dist/transformers.min.js"></script>
<script>
let model, tokenizer;

// تحميل النموذج الصغير والسريع
async function loadModel() {
    addMessage("النظام", "جارٍ تحميل النموذج...");
    model = await window.transformers.AutoModelForCausalLM.from_pretrained('distilgpt2');
    tokenizer = await window.transformers.AutoTokenizer.from_pretrained('distilgpt2');
    addMessage("النظام", "النموذج جاهز! اسأل أي شيء.");
}

// إضافة رسالة في صندوق الدردشة
function addMessage(sender, message) {
    const chatBox = document.getElementById('chatBox');
    chatBox.innerHTML += `<p><b>${sender}:</b> ${message}</p>`;
    chatBox.scrollTop = chatBox.scrollHeight;
}

// وظيفة الدردشة
async function askAI() {
    const input = document.getElementById('userInput').value.trim();
    if (!input) return;

    addMessage("أنت", input);
    document.getElementById('userInput').value = "";

    // تحقق من الأسئلة الحرجة (مثال: العام الحالي)
    const keywords = ["في أي عام", "العام الحالي", "اي سنة"];
    if (keywords.some(word => input.includes(word))) {
        addMessage("AI", "2026");
        return;
    }

    // الرد الطبيعي من DistilGPT2
    const encoded = tokenizer.encode(input);
    const output = await model.generate(encoded, { max_length: 100 });
    const decoded = tokenizer.decode(output[0]);

    addMessage("AI", decoded);
}

loadModel();
</script>
</body>
</html>
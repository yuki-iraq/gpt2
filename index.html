<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnimeHub</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#111; color:#fff; }
  header { padding:20px; background:#222; display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; }
  header h1 { margin:0; font-size:24px; }
  #searchBar { padding:10px; border-radius:5px; border:none; width:250px; }
  #buttons { display:flex; gap:10px; flex-wrap:wrap; }
  #buttons button { padding:8px 15px; border:none; border-radius:5px; cursor:pointer; background:#ff6600; color:#fff; font-weight:bold; }
  #animeGrid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:15px; padding:20px; }
  .animeCard { background:#333; border-radius:8px; overflow:hidden; cursor:pointer; transition:0.3s; position:relative; }
  .animeCard:hover { transform:scale(1.05); }
  .animeCard img { width:100%; height:200px; object-fit:cover; }
  .animeTitle { padding:10px; text-align:center; font-weight:bold; }
  .favHeart { position:absolute; top:5px; right:5px; font-size:20px; cursor:pointer; }
  #animeDetails { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); padding:40px; overflow-y:auto; }
  #closeBtn { float:right; cursor:pointer; font-size:30px; color:#ff6600; }
  #episodeList { display:flex; flex-wrap:wrap; gap:10px; margin-top:15px; }
  #episodeList button { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; background:#ff6600; color:#fff; }
  video { width:100%; max-width:600px; margin-top:15px; border-radius:5px; }
  #sidebar { position:fixed; right:0; top:0; width:250px; height:100%; background:#222; padding:20px; overflow-y:auto; display:none; }
  #sidebar h2 { text-align:center; }
  #sidebar button { display:block; width:100%; margin:5px 0; padding:8px; border:none; border-radius:5px; background:#ff6600; color:#fff; cursor:pointer; text-align:left; }
</style>
</head>
<body>
<header>
  <h1>AnimeHub</h1>
  <input type="text" id="searchBar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…ÙŠ...">
  <div id="buttons">
    <button onclick="showAll()">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
    <button onclick="toggleFav()">Ø§Ù„Ù…ÙØ¶Ù„Ø© â¤ï¸</button>
    <button onclick="showSeason()">Ø§Ù„Ù…ÙˆØ§Ø³Ù…</button>
  </div>
</header>

<div id="animeGrid"></div>

<div id="animeDetails">
  <span id="closeBtn">&times;</span>
  <h2 id="detailTitle"></h2>
  <img id="detailCover" src="" alt="" style="width:300px;height:auto;">
  <p><b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> <span id="detailStatus"></span></p>
  <p><b>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù„Ù‚Ø§Øª:</b> <span id="detailEpisodes"></span></p>
  <p><b>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ:</b> <span id="detailScore"></span></p>
  <p><b>Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ:</b> <span id="detailStudio"></span></p>
  <p><b>Ø§Ù„Ø£Ù†ÙˆØ§Ø¹:</b> <span id="detailGenres"></span></p>
  <p id="detailDescription"></p>
  <div id="episodeList"></div>
  <video id="episodePlayer" controls></video>
</div>

<div id="sidebar">
  <h2>Ø§Ù„Ù…ÙØ¶Ù„Ø© â¤ï¸</h2>
  <div id="favList"></div>
</div>

<script>
const grid = document.getElementById("animeGrid");
const searchBar = document.getElementById("searchBar");
const details = document.getElementById("animeDetails");
const closeBtn = document.getElementById("closeBtn");
const detailTitle = document.getElementById("detailTitle");
const detailCover = document.getElementById("detailCover");
const detailDesc = document.getElementById("detailDescription");
const detailStatus = document.getElementById("detailStatus");
const detailEpisodes = document.getElementById("detailEpisodes");
const detailScore = document.getElementById("detailScore");
const detailStudio = document.getElementById("detailStudio");
const detailGenres = document.getElementById("detailGenres");
const episodeList = document.getElementById("episodeList");
const episodePlayer = document.getElementById("episodePlayer");
const sidebar = document.getElementById("sidebar");
const favList = document.getElementById("favList");

let favorites = JSON.parse(localStorage.getItem("favorites")) || [];

// ğŸŒŸ AniList API
async function fetchAllAnime(page=1) {
  const query = `
  query ($page: Int) {
    Page(page:$page, perPage:30) {
      media(type:ANIME) {
        id
        title { romaji english }
        coverImage { large }
        description
        status
        episodes
        averageScore
        studios { nodes { name } }
        genres
        season
        seasonYear
      }
    }
  }`;
  const resp = await fetch("https://graphql.anilist.co", {
    method:"POST",
    headers:{'Content-Type':'application/json','Accept':'application/json'},
    body:JSON.stringify({query, variables:{page}})
  });
  const data = await resp.json();
  return data.data.Page.media;
}

// ğŸŒŸ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
async function searchAnime(query){
  if(!query) return;
  const all = await fetchAllAnime(); // Ù†Ù‚Ø¯Ø± Ù†Ø¹Ø¯Ù„ Ù„Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‚Ø±ÙŠØ¨
  const results = all.filter(a=>a.title.romaji.toLowerCase().includes(query.toLowerCase()) || (a.title.english && a.title.english.toLowerCase().includes(query.toLowerCase())));
  displayAnime(results);
}

// ğŸŒŸ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª
function displayAnime(animes){
  grid.innerHTML="";
  if(animes.length===0){ grid.innerHTML="<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø£Ù†Ù…ÙŠ.</p>"; return; }
  animes.forEach(anime=>{
    const card=document.createElement("div");
    card.className="animeCard";
    card.innerHTML=`<span class="favHeart">${favorites.includes(anime.id)?'â¤ï¸':'ğŸ–¤'}</span>
    <img src="${anime.coverImage.large}" alt="${anime.title.romaji}">
    <div class="animeTitle">${anime.title.romaji}</div>`;
    
    // ÙØªØ­ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    card.onclick=()=>showDetails(anime);
    
    // Ø§Ù„Ù‚Ù„Ø¨
    card.querySelector(".favHeart").onclick=(e)=>{
      e.stopPropagation();
      toggleFavorite(anime.id, e.target);
    };
    
    grid.appendChild(card);
  });
}

// ğŸŒŸ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
function showDetails(anime){
  details.style.display="block";
  detailTitle.textContent = anime.title.romaji;
  detailCover.src = anime.coverImage.large;
  detailDesc.innerHTML = anime.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ";
  detailStatus.textContent = anime.status || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  detailEpisodes.textContent = anime.episodes || "?";
  detailScore.textContent = anime.averageScore || "?";
  detailStudio.textContent = anime.studios.nodes.map(s=>s.name).join(", ") || "?";
  detailGenres.textContent = anime.genres.join(", ") || "?";
}

// ğŸŒŸ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
closeBtn.onclick = ()=>{ details.style.display="none"; episodePlayer.pause(); episodePlayer.src=""; };

// ğŸŒŸ Ø§Ù„Ù…ÙØ¶Ù„Ø©
function toggleFavorite(id, elem){
  if(favorites.includes(id)){
    favorites = favorites.filter(x=>x!==id);
    elem.textContent='ğŸ–¤';
  } else { favorites.push(id); elem.textContent='â¤ï¸'; }
  localStorage.setItem("favorites", JSON.stringify(favorites));
  renderFavorites();
}

function renderFavorites(){
  favList.innerHTML="";
  if(favorites.length===0){ favList.innerHTML="<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØ¶Ù„Ø©</p>"; return; }
  favorites.forEach(id=>{
    fetchAllAnime().then(all=>{
      const anime = all.find(a=>a.id===id);
      if(anime){
        const btn=document.createElement("button");
        btn.textContent = anime.title.romaji;
        btn.onclick = ()=>showDetails(anime);
        favList.appendChild(btn);
      }
    });
  });
}

// ğŸŒŸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
function toggleFav(){ sidebar.style.display = sidebar.style.display==='block'?'none':'block'; }

// ğŸŒŸ Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª
async function showAll(){ const all = await fetchAllAnime(); displayAnime(all); }

// ğŸŒŸ Ø§Ù„Ù…ÙˆØ§Ø³Ù…
async function showSeason(){
  const all = await fetchAllAnime();
  const seasons = [...new Set(all.map(a=>a.season + " " + a.seasonYear))];
  const season = prompt("Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ³Ù…:\n" + seasons.join("\n"));
  const results = all.filter(a=>(a.season + " " + a.seasonYear) === season);
  displayAnime(results);
}

// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Enter
searchBar.addEventListener("keyup",(e)=>{
  if(e.key==="Enter") searchAnime(searchBar.value);
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
fetchAllAnime().then(displayAnime);
renderFavorites();
</script>
</body>
</html>